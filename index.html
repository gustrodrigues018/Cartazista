<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle de Estoque - Cartazista</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 30px;
      margin: 0;
    }

    h1 {
      text-align: center;
      color: #222;
      margin-bottom: 10px;
    }

    h2 {
      color: #333;
      text-align: left;
      margin: 40px 0 10px 0;
      font-size: 22px;
      border-left: 5px solid #4CAF50;
      padding-left: 10px;
    }

    /* üîç Barra de pesquisa */
    #pesquisa {
      display: block;
      width: 60%;
      margin: 0 auto 30px auto;
      padding: 12px;
      font-size: 16px;
      border: 2px solid #ccc;
      border-radius: 8px;
      transition: 0.3s;
      outline: none;
    }

    #pesquisa:focus {
      border-color: #4CAF50;
      box-shadow: 0 0 8px rgba(76, 175, 80, 0.3);
    }

    form {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 30px;
      max-width: 95%;
      margin-left: auto;
      margin-right: auto;
    }

    input, button {
      padding: 10px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 15px;
    }

    input {
      flex: 1 1 200px;
    }

    button {
      cursor: pointer;
      background: #4CAF50;
      color: white;
      border: none;
      transition: 0.2s;
      flex: 1 1 120px;
      max-width: 150px;
    }

    button:hover {
      background: #45a049;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      text-align: center;
      table-layout: fixed;
    }

    th, td {
      border-bottom: 1px solid #ddd;
      padding: 14px;
      text-align: center;
      font-size: 15px;
      word-wrap: break-word;
    }

    th {
      background: #333;
      color: white;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .actions button {
      margin: 0 3px;
      padding: 6px 10px;
      font-size: 14px;
    }

    .entrada { background: #2196f3; }
    .saida { background: #f44336; }
    .entrada:hover { background: #1976d2; }
    .saida:hover { background: #d32f2f; }

    @media (max-width: 900px) {
      #pesquisa { width: 90%; }
      form { flex-direction: column; align-items: stretch; }
      table { font-size: 13px; }
      th, td { padding: 10px; }
    }
  </style>
</head>
<body>
  <h1>Controle de Estoque - Cartazista</h1>

  <form id="form">
    <input type="text" id="nome" placeholder="Nome do artigo" required>
    <input type="text" id="categoria" placeholder="Categoria (Papel ou outro)" required>
    <input type="number" id="quantidade" placeholder="Quantidade" min="1" required>
    <input type="text" id="tipo" placeholder="Tipo (ex: branco, com orelha...)" >
    <button type="submit">Adicionar</button>
  </form>

   <!-- üîç Barra de pesquisa -->
  <input type="text" id="pesquisa" placeholder="Pesquisar em todo o texto... (ex: papelbranco, etiqueta adesivo, portaetiqueta...)">

  <h2>Pap√©is</h2>
  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>Categoria</th>
        <th>Quantidade</th>
        <th>Tipo</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody id="tabela-papeis"></tbody>
  </table>

  <h2>Consum√≠veis</h2>
  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>Categoria</th>
        <th>Quantidade</th>
        <th>Tipo</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody id="tabela-consumiveis"></tbody>
  </table>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    getDocs,
    addDoc,
    updateDoc,
    deleteDoc,
    doc
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD8iI8BNm9hj9xma1W9N5r_hHSqrCfeoZo",
    authDomain: "cartazista-af2dd.firebaseapp.com",
    projectId: "cartazista-af2dd",
    storageBucket: "cartazista-af2dd.firebasestorage.app",
    messagingSenderId: "100291315254",
    appId: "1:100291315254:web:8f4af8e7aa3b6159f53a97"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const refEstoque = collection(db, "estoque-cartazista");

  /* -------------------------------------- */
  /*   üî• FUN√á√ÉO PARA CARREGAR ITENS        */
  /* -------------------------------------- */
  async function carregarEstoque() {
    const snap = await getDocs(refEstoque);
    estoque = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    atualizarTabelas(pesquisa.value);
  }

  /* -------------------------------------- */
  /* üî• ADICIONAR ITEM NO FIRESTORE        */
  /* -------------------------------------- */
  async function adicionarItem(item) {
    await addDoc(refEstoque, item);
    await carregarEstoque();
  }

  /* -------------------------------------- */
  /* üî• EDITAR ITEM                         */
  /* -------------------------------------- */
  async function editarItem(id, novosDados) {
    const ref = doc(db, "estoque-cartazista", id);
    await updateDoc(ref, novosDados);
    await carregarEstoque();
  }

  /* -------------------------------------- */
  /* üî• EXCLUIR ITEM                        */
  /* -------------------------------------- */
  async function excluirItem(id) {
    const ref = doc(db, "estoque-cartazista", id);
    await deleteDoc(ref);
    await carregarEstoque();
  }

  /* -------------------------------------- */
  /* üî• ENTRADA & SA√çDA NO FIRESTORE        */
  /* -------------------------------------- */
  async function movimentar(id, novaQtd) {
    const ref = doc(db, "estoque-cartazista", id);
    await updateDoc(ref, { quantidade: novaQtd });
    await carregarEstoque();
  }

  /* -------------------------------------- */
  /* üî• SEU SCRIPT ORIGINAL (ADAPTADO)      */
  /* -------------------------------------- */

  const form = document.getElementById('form');
  const pesquisa = document.getElementById('pesquisa');
  const tabelaPapeis = document.getElementById('tabela-papeis');
  const tabelaConsumiveis = document.getElementById('tabela-consumiveis');
  const botao = form.querySelector('button');

  let estoque = [];
  let indiceEdicao = null;

  function normalizar(texto = '') {
    return texto
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .replace(/\s+/g, " ")
      .trim();
  }

  function normalizarSemEspaco(texto = '') {
    return normalizar(texto).replace(/\s/g, '');
  }

  function atualizarTabelas(filtro = '') {
    tabelaPapeis.innerHTML = '';
    tabelaConsumiveis.innerHTML = '';

    const filtroNormalizado = normalizarSemEspaco(filtro);

    estoque
      .map((item, index) => ({ item, index }))
      .filter(({ item }) => {
        const texto = normalizarSemEspaco(
          ${item.nome} ${item.categoria} ${item.quantidade} ${item.tipo ?? ''}
        );
        return texto.includes(filtroNormalizado);
      })
      .forEach(({ item, index }) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.nome}</td>
          <td>${item.categoria}</td>
          <td>${item.quantidade}</td>
          <td>${item.tipo || '-'}</td>
          <td class="actions">
            <button onclick="entrada('${item.id}')">Entrada</button>
            <button onclick="saida('${item.id}', ${item.quantidade})">Sa√≠da</button>
            <button onclick="editarLinha(${index})">‚úèÔ∏è Editar</button>
            <button onclick="excluir('${item.id}')">Excluir</button>
          </td>
        `;

        if (normalizar(item.categoria).includes('papel')) {
          tabelaPapeis.appendChild(tr);
        } else {
          tabelaConsumiveis.appendChild(tr);
        }
      });
  }

  form.addEventListener("submit", async e => {
    e.preventDefault();

    const nome = form.nome.value.trim();
    const categoria = form.categoria.value.trim();
    const quantidade = parseInt(form.quantidade.value);
    const tipo = form.tipo.value.trim();

    if (indiceEdicao !== null) {
      const item = estoque[indiceEdicao];
      await editarItem(item.id, { nome, categoria, quantidade, tipo });
      indiceEdicao = null;
      botao.textContent = "Adicionar";
    } else {
      await adicionarItem({ nome, categoria, quantidade, tipo });
    }

    form.reset();
  });

  window.entrada = async function (id) {
    const item = estoque.find(i => i.id === id);
    const qtd = parseInt(prompt("Quantas unidades adicionar?"));
    if (!isNaN(qtd) && qtd > 0) {
      await movimentar(id, item.quantidade + qtd);
    }
  };

  window.saida = async function (id, atual) {
    const qtd = parseInt(prompt("Quantas unidades retirar?"));
    if (!isNaN(qtd) && qtd > 0 && atual >= qtd) {
      await movimentar(id, atual - qtd);
    } else {
      alert("Quantidade inv√°lida!");
    }
  };

  window.excluir = async function (id) {
    if (confirm("Excluir item?")) {
      await excluirItem(id);
    }
  };

  window.editarLinha = function (index) {
    const item = estoque[index];
    form.nome.value = item.nome;
    form.categoria.value = item.categoria;
    form.quantidade.value = item.quantidade;
    form.tipo.value = item.tipo || '';

    indiceEdicao = index;
    botao.textContent = "Salvar Edi√ß√£o";
  };

  pesquisa.addEventListener('input', e => atualizarTabelas(e.target.value));

  carregarEstoque();
</script>

</body>
</html>
